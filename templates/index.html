<!doctype html>
<html lang="uk">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Цифрова платформа РОІППО</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
  <body>
    {% if logged_in %}
      <div class="navbar-wrap">
        <nav class="navbar">
          <div class="nav">
            <a class="logo" href="{{ url_for('index') }}" aria-label="Логотип">
              <span class="logo-badge" aria-hidden="true"></span>
              <span class="logo-text">РОІППО</span>
            </a>
            <div class="nav-links">
            <a class="nav-link active" href="{{ url_for('index') }}">Бронювання авдиторій</a>
              <a class="nav-link" href="{{ url_for('schedule') }}">Електронний розклад</a>
            </div>
          </div>
          <div class="nav-right">
            <div class="account" id="accountWidget">
              <button class="avatar" id="accountTrigger" aria-label="Меню акаунта" type="button">{{ (user.email or 'U')[:1] | upper }}</button>
              <div class="account-menu" id="accountMenu">
                <div class="account-row"><strong>{{ user.email }}</strong></div>
                <div class="account-row muted">{{ user.first_name or '' }} {{ user.last_name or '' }}</div>
                <hr>
                <a href="{{ url_for('profile') }}" class="account-row">Профіль</a>
                <a href="{{ url_for('settings') }}" class="account-row">Налаштування</a>
                <form action="{{ url_for('logout') }}" method="post" class="account-row" style="margin:0;padding:0;">
                  <button type="submit" class="linklike">Вийти</button>
                </form>
              </div>
            </div>
          </div>
        </nav>
      </div>
    {% endif %}

    <main class="container">
      <h1>Цифрова платформа РОІППО</h1>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash">
            {% for category, message in messages %}
              <div class="flash-item {{ category }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% if error_message %}
        <div class="flash-item error">{{ error_message }}</div>
      {% endif %}

      {% if not logged_in %}
        <section class="hero">
          <h2>Ласкаво просимо до Цифрової платформи РОІППО</h2>
          <p class="muted">Увійдіть або зареєструйтесь, щоб користуватися сервісами платформи та отримати доступ до функцій для викладачів і адміністрації.</p>
          <div class="cta">
            <a href="{{ url_for('login') }}" class="btn btn-primary">Увійти</a>
            <a href="{{ url_for('register') }}" class="btn btn-outline">Зареєструватись</a>
          </div>
        </section>
      {% else %}
        <section class="form-section">
          <form action="{{ url_for('reserve') }}" method="post" class="form">
            <div class="form-row">
              <label for="auditoriya">Номер авдиторії</label>
              <input id="auditoriya" name="auditoriya" type="text" required>
            </div>
            <div class="form-row">
              <label for="date">Дата</label>
              <input id="date" name="date" type="date" required>
            </div>
            <div class="form-actions">
              <button type="submit">Забронювати</button>
            </div>
          </form>
        </section>

        <section class="list-section">
          <h2>Всі бронювання</h2>
          {% if reservations and reservations|length > 0 %}
            <ul class="reservations">
              {% for r in reservations %}
                <li>
                  <span>Авдиторія: <strong>{{ r["auditoriya"] }}</strong></span>
                  <span>Дата: <strong>{{ r["date"] }}</strong></span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>Немає бронювань</p>
          {% endif %}
        </section>
      {% endif %}
    </main>
  </body>
  <script>
    (function(){
      const widget = document.getElementById('accountWidget');
      const trigger = document.getElementById('accountTrigger');
      const menu = document.getElementById('accountMenu');
      if(!widget || !trigger || !menu) return;
      function close(){ widget.classList.remove('open'); }
      function open(){ widget.classList.add('open'); }
      trigger.addEventListener('click', function(e){
        e.stopPropagation();
        if(widget.classList.contains('open')){ close(); } else { open(); }
      });
      document.addEventListener('click', function(){ close(); });
      menu.addEventListener('click', function(e){ e.stopPropagation(); });
    })();
  </script>
  </html>


